<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>map - MR Photography</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="mr-photography.png">
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="navbar.js"></script>
</head>
<style>
    #map{
    height: 600px;
    width: 750px;
    }
</style>
<div class="container">
    <div class="text-center" style="color:white;">
        <h3>catalogue map</h3>
        <p>A map of the generalised locations for the pictures and the animals snapped at the given location.</p>
    </div>
    <div class=" justify-content-center d-flex mb-2 mt-2">

        <div id="map"></div>
    </div>
</div>
<script>
    var map = L.map('map').setView([53.386111, -1.506000], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

function fetchCoordiates(){
    fetch(`api/get_coordinates.php`)
      .then(res => res.json())
      .then(data => {
        data.forEach((locations) => {
            fetchAnimalsAtLocation(locations.location_id)
            .then(animalList => {
                L.marker([locations.latitude, locations.longitude]).addTo(map).bindPopup(`<h5>${locations.location_name}</h5><br>${animalList}`);
            })
        }
    )})};

function fetchAnimalsAtLocation(locationId){
    return fetch(`api/get_animals_at_location.php?location_id=${locationId}`)
    .then(res => res.json())
    .then(data => {
        const animalNames = data.map(item => `<a href="./animal.html?animal_id=${item.animal_id}">${item.common_name}</a>`);
        return `<ul>${animalNames.map(name => `<li>${name}</li>`).join('')}</ul>`;
    })
}
fetchCoordiates();

</script>
<script src="map.js"></script>
<script src="footer.js"></script>
</body>
</html>