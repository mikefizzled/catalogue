<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Catalogue</title>
    <!-- Add your CSS file here -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="mr-photography.png">
    <script src="navbar.js"></script>
    
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <div class="container">
      <div class="catalogue-card justify-content-center">
        <div class="col-md-12 mb-3">
            <h2 style="text-align: center;">Animal Catalogue</h2>
        </div>
        <div class="row justify-content-center">
            <div class="col-4 option-a">
                <label for="classes" class="form-label">Class</label>
                <select class="form-select" id="classes">
                  <option value=" ">All</option>
                </select>
            </div>
            <div class="col-8 option-a">
                <label for="families" class="form-label">Family</label>
                <select class="form-select" id="families">
                  <option value=" ">All</option>
                </select>
                
            </div>
        </div>
    </div>
    
  </div>

    <div class="container" id="animal-gallery"></div>

    <script>
      
window.onload = function () {
  const classSelect = document.getElementById('classes');
  const familySelect = document.getElementById('families');
  
  const selectedClassId = classSelect.value;
  const selectedFamilyId = familySelect.value; // Get the initial selected family_id
  
  if (selectedClassId){
    fetchFamiliesByClass(selectedClassId);
  }
  if (selectedFamilyId) {
    fetchAnimalsByFamily(selectedFamilyId);
  }
}

        fetch("api/get_classes.php")
          .then(res => res.json())
          .then(data => {
            let select = document.getElementById("classes");
            data.forEach((classes) => {
              let option = document.createElement("option");
              option.classList.add('option-a');
              option.value = classes.class_id; // Set the value to the family_id
              option.textContent = `${classes.class_name}`; // Display the desired text
              select.appendChild(option);
            });
          });


        function fetchFamiliesByClass(classId){
        fetch(`api/get_families.php?class_id=${classId}`)
        .then(res => res.json())
        .then(data => {
          let select = document.getElementById("families");
          let firstOption = document.getElementById("families").options[0];
          select.innerHTML = "";
          select.appendChild(firstOption);
          data.forEach((family) => {
            let option = document.createElement("option");
            option.classList.add('option-a');
            option.value = family.family_id; // Set the value to the family_id
            option.textContent = `${family.family_name} (${family.common_name})`; // Display the desired text
            select.appendChild(option);
          });
        });
      }

        // Get Animal data
        function fetchAnimalsByFamily(familyId){
        fetch(`api/get_animals.php?family_id=${familyId}`)
          .then(response => response.json())
          .then(data => {
            const galleryContainer = document.getElementById('animal-gallery');
            galleryContainer.innerHTML = '';
            data.forEach(animal => {
              const col = document.createElement('a');
              col.classList.add('streched-link','a-card');
              col.href = `animal.html&${animal.animal_id}`;
              col.innerHTML = `
              <div class="card animal-card">
                <img src="thumbnails/${animal.thumbnail}" alt="${animal.common_name}"class="card-img-top">
                <div>
                  <p class="text-center p-card">${animal.common_name}</p>
                </div>
              </div>
              </a>`;
            galleryContainer.appendChild(col);
          });
        })
        .catch(error => console.error('Error fetching data:', error));
        }
  
  
  const classSelected = document.getElementById('classes');
  classSelected.addEventListener('change', (event) =>{
    const selectClassId = event.target.value;
    if (selectClassId){
      fetchFamiliesByClass(selectClassId);
    }
  })
  const select = document.getElementById('families');

  select.addEventListener('change', (event) => {
    const selectFamilyId = event.target.value;
    if(selectFamilyId){
      fetchAnimalsByFamily(selectFamilyId);
    }
  })

    </script>
</body>
</html>
