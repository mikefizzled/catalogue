<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Template</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="mr-photography.png">
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="animal.css">
    <script src="navbar.js"></script>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <div class="container">
      <div class="row">
        <div class="col-md-12 mb-3">
          <div class="card">
          <div id="carousel"class="carousel slide carousel-fade" data-bs-ride="carousel" >
            <div class="carousel-inner" data-bs-ride="true" >
            <img src="images/goldfinch.jpg" class="card-img-top" alt="Animal Image" id="main-picture">
            <div class="card-body">
              <h5 class="card-title">Caption</h5>
            </div>
          </div>            
        </div></div></div>
        <div class="col-sm-4 mb-3">
          <div class="card detail-card">
            <div class="card-body">
              <table class="table detail-table table-responsive">
                <thead class="no-border">
                  <th>
                    <h2 class="centered" id="common-name"></h2>
                    <h4 class="centered"><i id="scientific-name"></i></h4>
                  </th>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">Class</th>
                    <td><div id="class"></div></td>
                  </tr>
                  <tr>
                    <th scope="row">Order</th>
                    <td id="order"></td>
                  </tr>
                  <tr>
                    <th scope="row">Family</th>
                    <td id="family"></td>
                  </tr>
                  <tr>
                    <th scope="row">Genus</th>
                    <td id="genus"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card detail-card my-2">
            <a href="catalogue.html" class="btn return-button">Back To Catalogue</a>
        </div>
        </div>

      </div>
    </div>
    <script>   
    
    const urlParams = new URLSearchParams(window.location.search);
    const animalId = urlParams.get('animal_id');

    fetch(`api/get_single_animal.php?animal_id=${animalId}`)
    .then(response => response.json())
    .then(data => {
      // Update the class value here
      let common_name = document.getElementById('common-name');
      let scientific_name = document.getElementById('scientific-name');
      let class_text = document.getElementById("class");
      let genus_text = document.getElementById("genus");
      let family_text = document.getElementById("family");
      let order_text = document.getElementById('order');
      let picture = document.getElementById('main-picture');

      common_name.textContent = data.common_name;
      scientific_name.textContent = data.scientific_name;
      class_text.textContent = data.class_name;
      genus_text.textContent = data.genus_name;
      family_text.textContent  = data.family_name;
      order_text.textContent = data.order_name;
      picture.src = 'thumbnails/' + data.thumbnail;
      let title = data.common_name + ' - Animal Catalogue';
      document.title = title;
      console.log('API Response:', data);

  })
  .catch(error => {
    console.error('Error fetching data:', error);
  });


    fetch(`api/get_animal_photos.php?animal_id=${animalId}`)
      .then(response => response.json())
      .then(data => {
        const galleryContainer = document.getElementById('carousel');
        galleryContainer.innerHTML = '';
        data.forEach(animal_image => {
          const dateTaken = new Date(animal_image.date_taken);
          const formattedDate = dateTaken.toLocaleDateString('en-GB', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
          });

          const col = document.createElement('div');
          col.classList.add('carousel-item');
          col.setAttribute('data-bs-interval', '10000');
          col.innerHTML = `
          <img src="images/${animal_image.filename}" class="d-block w-100  img-fluid" alt="${animal_image.caption ? animal_image.caption : 'A picture of a ' + animal_image.common_name}">
          <div class="caption">
              <h5>${animal_image.location_name}, ${animal_image.location_city} - ${formattedDate} </h5>
            </div>
          </div>`;
        galleryContainer.appendChild(col);
      });
    // Set active to first carousel item
    if (galleryContainer.firstChild) {
      galleryContainer.firstChild.classList.add('active');
    }
        // Create and append the carousel controls
      const prevButton = document.createElement('button');
    prevButton.className = 'carousel-control-prev';
    prevButton.type = 'button';
    prevButton.setAttribute('data-bs-target', '#carousel');
    prevButton.setAttribute('data-bs-slide', 'prev');
    prevButton.innerHTML = `
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    `;

    const nextButton = document.createElement('button');
    nextButton.className = 'carousel-control-next';
    nextButton.type = 'button';
    nextButton.setAttribute('data-bs-target', '#carousel');
    nextButton.setAttribute('data-bs-slide', 'next');
    nextButton.innerHTML = `
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    `;

    galleryContainer.appendChild(prevButton);
    galleryContainer.appendChild(nextButton);
    })
    .catch(error => console.error('Error fetching data:', error));
    
        </script>
            <script src="footer.js"></script>
  </body>
</html>